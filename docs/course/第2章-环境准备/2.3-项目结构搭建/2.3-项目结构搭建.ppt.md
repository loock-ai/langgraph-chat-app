---
marp: true
theme: gaia
paginate: true
header: '2.3-项目结构搭建'
style: |
  section {
    font-size: 30px;
  }
---

<!-- _class: lead -->
# 2.3 项目结构搭建 📁

## 构建清晰可维护的项目架构

**LangGraph智能聊天应用开发教程**

---

## 🎯 学习目标概述

### 本节课的核心价值
- **🏗️ 掌握项目架构设计**：学会组织复杂项目的文件结构
- **📋 建立开发规范**：统一团队的项目组织方式
- **⚡ 提升开发效率**：清晰的结构减少开发时间

### 具体学习目标
- 理解Next.js项目的标准结构
- 掌握pnpm工作区的配置
- 学会配置TypeScript和ESLint
- 了解项目配置文件的作用

---

## 🏗️ 项目结构总览

### 完整项目架构
```
langgraph-chat-app/
├── 📱 app/                  # Next.js应用目录
├── 📚 docs/                 # 项目文档
├── 🔧 config/               # 配置文件
├── 📦 package.json          # 项目依赖
├── 🌐 pnpm-workspace.yaml   # 工作区配置
├── 📝 tsconfig.json         # TypeScript配置
├── 🔍 eslint.config.mjs     # 代码规范配置
└── 📋 README.md             # 项目说明
```

每个目录都有明确的职责和用途。

---

## 🚀 创建项目骨架

### 第一步：创建项目目录
```bash
# 创建项目根目录
mkdir langgraph-chat-app
cd langgraph-chat-app

# 初始化Git仓库
git init
git branch -M main

# 创建基本目录结构
mkdir app docs config
mkdir app/{api,components,utils}
mkdir app/api/{chat,sessions}
mkdir docs/course
```

### 第二步：初始化pnpm项目
```bash
# 初始化package.json
pnpm init

# 设置工作区
echo 'packages:
  - "app"
  - "docs"' > pnpm-workspace.yaml
```

---

## 📱 App目录结构

### Next.js App Router结构
```
app/
├── 🔗 api/                  # API路由
│   ├── chat/
│   │   ├── route.ts         # 聊天API
│   │   └── sessions/
│   │       └── route.ts     # 会话管理API
├── 🧩 components/           # React组件
│   ├── SessionSidebar.tsx   # 会话侧边栏
│   ├── ChatMessage.tsx      # 消息组件
│   └── MessageInput.tsx     # 输入组件
├── 🛠️ utils/                # 工具函数
│   ├── loadEnv.ts          # 环境变量加载
│   └── threadId.ts         # 线程ID生成
├── 🤖 agent/                # AI代理
│   ├── chatbot.ts          # 聊天机器人
│   ├── tools.ts            # AI工具
│   ├── db.ts               # 数据库操作
│   └── config/             # 代理配置
├── 📄 page.tsx              # 主页面
├── 🎨 layout.tsx            # 布局组件
├── 🌍 globals.css           # 全局样式
└── 🔖 favicon.ico           # 站点图标
```

---

## 📚 文档目录结构

### 课程文档组织
```
docs/
├── 📖 course/               # 课程内容
│   ├── 📋 course-outline.md # 课程大纲
│   ├── 📂 第1章-概念入门/
│   │   ├── 1.1-AI应用开发基础/
│   │   ├── 1.2-项目技术栈应用/
│   │   └── 1.3-项目架构设计/
│   ├── 📂 第2章-环境准备/
│   │   ├── 2.1-开发工具安装/
│   │   ├── 2.3-项目结构搭建/
│   │   └── 2.4-环境变量配置/
│   └── 📂 第3章-前端基础/
│       ├── 3.1-React基础应用/
│       ├── 3.2-Next.js项目应用/
│       └── 3.3-TypeScript实际应用/
├── 📝 README.md             # 文档说明
└── 🎬 recording-script.md   # 录制脚本
```

---

## 📦 Package.json 配置

### 项目依赖配置
```json
{
  "name": "langgraph-chat-app",
  "version": "1.0.0",
  "description": "AI聊天应用开发教程项目",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "next": "^15.0.0",
    "react": "^18.0.0",
    "react-dom": "^18.0.0",
    "@langchain/langgraph": "^0.0.34",
    "@langchain/openai": "^0.3.0"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "@types/react": "^18.0.0",
    "@types/node": "^20.0.0",
    "eslint": "^8.0.0",
    "eslint-config-next": "^15.0.0",
    "tailwindcss": "^3.0.0",
    "autoprefixer": "^10.0.0",
    "postcss": "^8.0.0"
  }
}
```

### 脚本命令说明
- **dev**：启动开发服务器
- **build**：构建生产版本
- **start**：启动生产服务器
- **lint**：检查代码规范
- **type-check**：TypeScript类型检查

---

## 🌐 pnpm工作区配置

### pnpm-workspace.yaml
```yaml
# pnpm工作区配置
packages:
  # 主应用
  - 'app'
  # 文档项目  
  - 'docs'
  # 共享包
  - 'packages/*'
  # 示例项目
  - 'examples/*'

# 排除模式
exclude:
  - '**/node_modules/**'
  - '**/dist/**'
  - '**/.next/**'
```

### 工作区优势
- **📦 依赖共享**：相同依赖只安装一次
- **🔗 内部链接**：包之间可以相互引用
- **⚡ 构建效率**：批量操作提升效率
- **🎯 版本统一**：确保依赖版本一致性

---

## 📝 TypeScript配置

### tsconfig.json
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["dom", "dom.iterable", "ES6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./app/*"],
      "@/components/*": ["./app/components/*"],
      "@/utils/*": ["./app/utils/*"],
      "@/agent/*": ["./app/agent/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
```

---

## 🔍 ESLint配置

### eslint.config.mjs
```javascript
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
  {
    rules: {
      // 自定义规则
      "@typescript-eslint/no-unused-vars": "error",
      "@typescript-eslint/no-explicit-any": "warn",
      "react-hooks/exhaustive-deps": "warn"
    }
  }
];

export default eslintConfig;
```

### 代码规范约定
- **🔒 严格模式**：启用TypeScript严格检查
- **⚠️ 警告处理**：未使用变量和any类型警告
- **🎯 React规范**：遵循React Hooks最佳实践

---

## 🎨 TailwindCSS配置

### tailwind.config.ts
```typescript
import type { Config } from "tailwindcss";

const config: Config = {
  content: [
    "./pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./components/**/*.{js,ts,jsx,tsx,mdx}",
    "./app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      colors: {
        // 自定义颜色
        'chat-user': '#007bff',
        'chat-assistant': '#6c757d',
        'chat-bg': '#f8f9fa'
      },
      fontFamily: {
        // 自定义字体
        'mono': ['JetBrains Mono', 'monospace'],
      }
    },
  },
  plugins: [
    // 添加常用插件
    require('@tailwindcss/typography'),
    require('@tailwindcss/forms'),
  ],
};

export default config;
```

### PostCSS配置
```javascript
// postcss.config.mjs
const config = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};

export default config;
```

---

## 🔧 Next.js配置

### next.config.ts
```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  // 实验性功能
  experimental: {
    // 启用App Router
    appDir: true,
    // 服务器组件
    serverComponentsExternalPackages: ['@langchain/langgraph']
  },
  
  // 环境变量
  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },
  
  // 重定向配置
  async redirects() {
    return [
      {
        source: '/home',
        destination: '/',
        permanent: true,
      },
    ];
  },
  
  // Webpack配置
  webpack: (config, { buildId, dev, isServer, defaultLoaders, webpack }) => {
    // 自定义webpack配置
    return config;
  },
};

export default nextConfig;
```

---

## 📋 项目初始化脚本

### setup.sh（自动化脚本）
```bash
#!/bin/bash
echo "🚀 初始化LangGraph聊天应用项目..."

# 创建目录结构
echo "📁 创建项目目录..."
mkdir -p app/{api/{chat,sessions},components,utils,agent/{config}}
mkdir -p docs/course
mkdir -p config

# 初始化项目
echo "📦 初始化项目配置..."
pnpm init

# 安装依赖
echo "⬇️ 安装项目依赖..."
pnpm add next react react-dom @langchain/langgraph @langchain/openai
pnpm add -D typescript @types/react @types/node eslint eslint-config-next tailwindcss autoprefixer postcss

# 初始化配置文件
echo "⚙️ 创建配置文件..."
npx tailwindcss init -p --ts

# 创建基本文件
echo "📝 创建基础文件..."
touch app/{page.tsx,layout.tsx,globals.css}
touch app/api/chat/route.ts
touch app/components/SessionSidebar.tsx

echo "✅ 项目初始化完成！"
echo "🎯 下一步：配置环境变量"
```

---

## 🔍 项目结构验证

### 检查清单
```bash
# 验证目录结构
tree -I 'node_modules|.next|dist' langgraph-chat-app/

# 验证配置文件
ls -la *.json *.yaml *.mjs *.ts

# 验证依赖安装
pnpm list

# 验证TypeScript配置
pnpm type-check

# 验证代码规范
pnpm lint
```

### 成功标准
- ✅ 目录结构清晰完整
- ✅ 配置文件正确无误
- ✅ 依赖安装成功
- ✅ TypeScript编译通过
- ✅ ESLint检查通过

---

## 💡 最佳实践建议

### 文件命名规范
```
📁 目录名：kebab-case (短横线命名)
📄 组件文件：PascalCase.tsx
📄 工具文件：camelCase.ts
📄 配置文件：kebab-case.config.ts
📄 类型文件：types.ts
```

### 目录组织原则
- **🎯 功能优先**：按功能模块组织代码
- **📱 层次清晰**：UI、逻辑、数据分层
- **🔄 可扩展性**：为未来功能预留空间
- **📋 一致性**：保持命名和结构一致

### 代码组织建议
- **🔗 相关性**：相关文件放在同一目录
- **📏 粒度控制**：避免目录过深或文件过大
- **🏷️ 明确标识**：文件名清楚表达用途

---

<!-- _class: lead -->
# 🎉 项目结构搭建完成！

## 现在有了清晰的项目架构

**下一节：环境变量配置**
