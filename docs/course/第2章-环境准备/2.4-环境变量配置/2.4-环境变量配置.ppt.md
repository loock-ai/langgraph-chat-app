---
marp: true
theme: gaia
paginate: true
header: '2.4-ç¯å¢ƒå˜é‡é…ç½®'
style: |
  section {
    font-size: 30px;
  }
---

<!-- _class: lead -->
# 2.4 ç¯å¢ƒå˜é‡é…ç½® âš™ï¸

## å®‰å…¨é«˜æ•ˆçš„é…ç½®ç®¡ç†

**LangGraphæ™ºèƒ½èŠå¤©åº”ç”¨å¼€å‘æ•™ç¨‹**

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡æ¦‚è¿°

### æœ¬èŠ‚è¯¾çš„æ ¸å¿ƒä»·å€¼
- **ğŸ” æŒæ¡å®‰å…¨é…ç½®ç®¡ç†**ï¼šä¿æŠ¤æ•æ„Ÿä¿¡æ¯å¦‚APIå¯†é’¥
- **ğŸŒ ç†è§£ç¯å¢ƒåˆ†ç¦»**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚åŒ–é…ç½®
- **âš¡ æå‡å¼€å‘æ•ˆç‡**ï¼šä¾¿æ·çš„é…ç½®åˆ‡æ¢å’Œç®¡ç†

### å…·ä½“å­¦ä¹ ç›®æ ‡
- ç†è§£ç¯å¢ƒå˜é‡çš„æ¦‚å¿µå’Œä½œç”¨
- æŒæ¡.envæ–‡ä»¶çš„åˆ›å»ºå’Œä½¿ç”¨
- å­¦ä¼šé…ç½®AIæœåŠ¡APIå¯†é’¥
- äº†è§£ä¸åŒç¯å¢ƒçš„é…ç½®ç­–ç•¥

---

## ğŸ” ç¯å¢ƒå˜é‡åŸºç¡€æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡ï¼Ÿ
ç¯å¢ƒå˜é‡æ˜¯**æ“ä½œç³»ç»Ÿçº§åˆ«çš„é…ç½®å‚æ•°**ï¼Œç”¨äºå­˜å‚¨ï¼š

- **ğŸ”‘ APIå¯†é’¥**ï¼šOpenAIã€Azureç­‰æœåŠ¡å¯†é’¥
- **ğŸŒ æœåŠ¡ç«¯ç‚¹**ï¼šä¸åŒç¯å¢ƒçš„APIåœ°å€
- **ğŸ“Š é…ç½®å‚æ•°**ï¼šæ•°æ®åº“è¿æ¥ã€ç¼“å­˜è®¾ç½®ç­‰
- **ğŸ›ï¸ åŠŸèƒ½å¼€å…³**ï¼šç‰¹æ€§æ ‡å¿—å’Œè°ƒè¯•é€‰é¡¹

### ä¸ºä»€ä¹ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Ÿ
- **ğŸ”’ å®‰å…¨æ€§**ï¼šæ•æ„Ÿä¿¡æ¯ä¸å‡ºç°åœ¨ä»£ç ä¸­
- **ğŸ”„ çµæ´»æ€§**ï¼šä¸ä¿®æ”¹ä»£ç å³å¯æ”¹å˜é…ç½®
- **ğŸŒ ç¯å¢ƒåˆ†ç¦»**ï¼šå¼€å‘/ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
- **ğŸ‘¥ å›¢é˜Ÿåä½œ**ï¼šæ¯ä¸ªå¼€å‘è€…å¯æœ‰ç‹¬ç«‹é…ç½®

---

## ğŸ“ .envæ–‡ä»¶ä½“ç³»

### æ–‡ä»¶ä¼˜å…ˆçº§é¡ºåº
```
.env.local          # æœ¬åœ°é…ç½®ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
    â†“
.env.development    # å¼€å‘ç¯å¢ƒä¸“ç”¨
    â†“  
.env.production     # ç”Ÿäº§ç¯å¢ƒä¸“ç”¨
    â†“
.env                # é»˜è®¤é…ç½®ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
```

Next.jsä¼šæŒ‰ç…§è¿™ä¸ªé¡ºåºåŠ è½½ç¯å¢ƒå˜é‡ï¼ŒååŠ è½½çš„ä¼šè¦†ç›–å…ˆåŠ è½½çš„ã€‚

### æ–‡ä»¶ç”¨é€”è¯´æ˜
- **`.env.local`**ï¼šä¸ªäººæœ¬åœ°é…ç½®ï¼Œä¸æäº¤åˆ°Git
- **`.env.development`**ï¼šå¼€å‘å›¢é˜Ÿå…±äº«çš„å¼€å‘é…ç½®
- **`.env.production`**ï¼šç”Ÿäº§ç¯å¢ƒé…ç½®
- **`.env`**ï¼šé»˜è®¤é…ç½®æ¨¡æ¿

---

## ğŸ”‘ AIæœåŠ¡é…ç½®

### OpenAIé…ç½®
```bash
# .env.local
# OpenAIé…ç½®
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4-turbo-preview
OPENAI_MAX_TOKENS=4096
OPENAI_TEMPERATURE=0.7

# ç»„ç»‡IDï¼ˆå¯é€‰ï¼‰
OPENAI_ORGANIZATION=org-xxxxxxxxxxxxxxxxxxxxxxxx
```

### Azure OpenAIé…ç½®
```bash
# .env.local
# Azure OpenAIé…ç½®
AZURE_OPENAI_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
AZURE_OPENAI_API_VERSION=2024-02-15-preview
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4-turbo

# Azureèµ„æºä¿¡æ¯
AZURE_OPENAI_RESOURCE_NAME=your-resource-name
```

### å…¶ä»–AIæœåŠ¡
```bash
# Anthropic Claude
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Google Gemini
GOOGLE_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# æœ¬åœ°LLMæœåŠ¡
LOCAL_LLM_ENDPOINT=http://localhost:11434
LOCAL_LLM_MODEL=llama3:8b
```

---

## ğŸŒ ç¯å¢ƒåˆ†ç¦»é…ç½®

### å¼€å‘ç¯å¢ƒé…ç½®
```bash
# .env.development
# å¼€å‘ç¯å¢ƒä¸“ç”¨é…ç½®

# APIæœåŠ¡
API_BASE_URL=http://localhost:3000
DEBUG_MODE=true
LOG_LEVEL=debug

# AIæœåŠ¡ï¼ˆå¼€å‘ç”¨ï¼‰
AI_PROVIDER=openai
AI_MODEL=gpt-3.5-turbo
AI_MAX_TOKENS=2048
AI_TEMPERATURE=0.8

# æ•°æ®åº“ï¼ˆæœ¬åœ°ï¼‰
DATABASE_URL=sqlite:./dev.db
REDIS_URL=redis://localhost:6379

# åŠŸèƒ½å¼€å…³
ENABLE_STREAMING=true
ENABLE_TOOLS=true
ENABLE_ANALYTICS=false
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®
```bash
# .env.production
# ç”Ÿäº§ç¯å¢ƒä¸“ç”¨é…ç½®

# APIæœåŠ¡
API_BASE_URL=https://your-app.com
DEBUG_MODE=false
LOG_LEVEL=error

# AIæœåŠ¡ï¼ˆç”Ÿäº§ç”¨ï¼‰
AI_PROVIDER=azure-openai
AI_MODEL=gpt-4-turbo
AI_MAX_TOKENS=4096
AI_TEMPERATURE=0.7

# æ•°æ®åº“ï¼ˆäº‘ç«¯ï¼‰
DATABASE_URL=postgresql://username:password@host:port/database
REDIS_URL=redis://redis-host:6379

# åŠŸèƒ½å¼€å…³
ENABLE_STREAMING=true
ENABLE_TOOLS=true
ENABLE_ANALYTICS=true
```

---

## ğŸ”§ Next.jsç¯å¢ƒå˜é‡é…ç½®

### å®¢æˆ·ç«¯å¯è®¿é—®å˜é‡
```bash
# ä»¥NEXT_PUBLIC_å¼€å¤´çš„å˜é‡å¯åœ¨å®¢æˆ·ç«¯è®¿é—®
NEXT_PUBLIC_APP_NAME=LangGraph Chat App
NEXT_PUBLIC_APP_VERSION=1.0.0
NEXT_PUBLIC_ANALYTICS_ID=G-XXXXXXXXXX
NEXT_PUBLIC_API_BASE_URL=https://api.yourapp.com
```

### æœåŠ¡ç«¯ä¸“ç”¨å˜é‡
```bash
# ä¸ä»¥NEXT_PUBLIC_å¼€å¤´çš„å˜é‡åªèƒ½åœ¨æœåŠ¡ç«¯è®¿é—®
DATABASE_URL=postgresql://...
OPENAI_API_KEY=sk-...
JWT_SECRET=your-super-secret-key
WEBHOOK_SECRET=whsec_...
```

### TypeScriptç±»å‹å®šä¹‰
```typescript
// types/env.d.ts
declare namespace NodeJS {
  interface ProcessEnv {
    // æœåŠ¡ç«¯ç¯å¢ƒå˜é‡
    OPENAI_API_KEY: string;
    DATABASE_URL: string;
    JWT_SECRET: string;
    
    // å®¢æˆ·ç«¯ç¯å¢ƒå˜é‡
    NEXT_PUBLIC_APP_NAME: string;
    NEXT_PUBLIC_API_BASE_URL: string;
  }
}
```

---

## ğŸ› ï¸ ç¯å¢ƒå˜é‡åŠ è½½å·¥å…·

### loadEnv.tså·¥å…·å‡½æ•°
```typescript
// app/utils/loadEnv.ts
interface EnvConfig {
  openai: {
    apiKey: string;
    baseUrl: string;
    model: string;
    maxTokens: number;
    temperature: number;
  };
  app: {
    name: string;
    version: string;
    debugMode: boolean;
  };
}

export function loadEnvConfig(): EnvConfig {
  // éªŒè¯å¿…éœ€çš„ç¯å¢ƒå˜é‡
  const requiredEnvs = ['OPENAI_API_KEY'];
  for (const env of requiredEnvs) {
    if (!process.env[env]) {
      throw new Error(`Missing required environment variable: ${env}`);
    }
  }

  return {
    openai: {
      apiKey: process.env.OPENAI_API_KEY!,
      baseUrl: process.env.OPENAI_BASE_URL || 'https://api.openai.com/v1',
      model: process.env.OPENAI_MODEL || 'gpt-3.5-turbo',
      maxTokens: parseInt(process.env.OPENAI_MAX_TOKENS || '2048'),
      temperature: parseFloat(process.env.OPENAI_TEMPERATURE || '0.7'),
    },
    app: {
      name: process.env.NEXT_PUBLIC_APP_NAME || 'LangGraph Chat App',
      version: process.env.NEXT_PUBLIC_APP_VERSION || '1.0.0',
      debugMode: process.env.DEBUG_MODE === 'true',
    },
  };
}
```

### ä½¿ç”¨ç¤ºä¾‹
```typescript
// app/api/chat/route.ts
import { loadEnvConfig } from '@/utils/loadEnv';

export async function POST(request: Request) {
  const config = loadEnvConfig();
  
  // ä½¿ç”¨é…ç½®åˆ›å»ºOpenAIå®¢æˆ·ç«¯
  const openai = new OpenAI({
    apiKey: config.openai.apiKey,
    baseURL: config.openai.baseUrl,
  });
  
  // ... å…¶ä»–é€»è¾‘
}
```

---

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### .gitignoreé…ç½®
```bash
# .gitignore
# ç¡®ä¿æ•æ„Ÿæ–‡ä»¶ä¸è¢«æäº¤

# ç¯å¢ƒå˜é‡æ–‡ä»¶
.env.local
.env*.local

# å¯èƒ½åŒ…å«å¯†é’¥çš„æ–‡ä»¶
*.key
*.pem
secrets/

# æ—¥å¿—æ–‡ä»¶
*.log
logs/

# ä¾èµ–å’Œæ„å»ºæ–‡ä»¶
node_modules/
.next/
dist/
build/
```

### å¯†é’¥ç®¡ç†ç­–ç•¥
```bash
# 1. ä½¿ç”¨å¼ºå¯†é’¥
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# 2. å®šæœŸè½®æ¢å¯†é’¥
# å»ºè®®æ¯ä¸ªæœˆè½®æ¢APIå¯†é’¥

# 3. æƒé™æœ€å°åŒ–
# åªç»™äºˆå¿…è¦çš„APIæƒé™

# 4. ç›‘æ§ä½¿ç”¨æƒ…å†µ
ENABLE_API_MONITORING=true
API_USAGE_ALERT_THRESHOLD=1000
```

---

## ğŸ“Š é…ç½®éªŒè¯å’Œæµ‹è¯•

### ç¯å¢ƒæ£€æŸ¥è„šæœ¬
```typescript
// scripts/check-env.ts
import { loadEnvConfig } from '../app/utils/loadEnv';

async function checkEnvironment() {
  console.log('ğŸ” æ£€æŸ¥ç¯å¢ƒé…ç½®...');
  
  try {
    const config = loadEnvConfig();
    console.log('âœ… ç¯å¢ƒé…ç½®åŠ è½½æˆåŠŸ');
    
    // æµ‹è¯•OpenAIè¿æ¥
    const openai = new OpenAI({
      apiKey: config.openai.apiKey,
    });
    
    const response = await openai.chat.completions.create({
      model: config.openai.model,
      messages: [{ role: 'user', content: 'Hello' }],
      max_tokens: 10,
    });
    
    console.log('âœ… OpenAI APIè¿æ¥æ­£å¸¸');
    console.log(`ğŸ“Š ä½¿ç”¨æ¨¡å‹: ${config.openai.model}`);
    
  } catch (error) {
    console.error('âŒ ç¯å¢ƒé…ç½®é”™è¯¯:', error.message);
    process.exit(1);
  }
}

checkEnvironment();
```

### è¿è¡Œæ£€æŸ¥
```bash
# æ·»åŠ åˆ°package.json scripts
"scripts": {
  "check-env": "ts-node scripts/check-env.ts",
  "dev": "npm run check-env && next dev"
}

# è¿è¡Œæ£€æŸ¥
pnpm check-env
```

---

## ğŸŒ éƒ¨ç½²ç¯å¢ƒé…ç½®

### Verceléƒ¨ç½²é…ç½®
```bash
# åœ¨Vercelæ§åˆ¶å°è®¾ç½®ç¯å¢ƒå˜é‡
OPENAI_API_KEY=sk-...
AZURE_OPENAI_API_KEY=...
DATABASE_URL=postgresql://...

# æˆ–ä½¿ç”¨Vercel CLI
vercel env add OPENAI_API_KEY
```

### Dockerç¯å¢ƒé…ç½®
```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

# å¤åˆ¶é…ç½®æ–‡ä»¶
COPY package.json pnpm-lock.yaml ./
COPY .env.production .env

# å®‰è£…ä¾èµ–
RUN npm install -g pnpm
RUN pnpm install --frozen-lockfile

# æ„å»ºåº”ç”¨
COPY . .
RUN pnpm build

EXPOSE 3000
CMD ["pnpm", "start"]
```

### ç¯å¢ƒå˜é‡æ³¨å…¥
```bash
# docker-compose.yml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - DATABASE_URL=${DATABASE_URL}
    env_file:
      - .env.production
```

---

## ğŸ› ï¸ å¼€å‘å·¥ä½œæµç¨‹

### æœ¬åœ°å¼€å‘æµç¨‹
```bash
# 1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env.local

# 2. ç¼–è¾‘æœ¬åœ°é…ç½®
nano .env.local

# 3. éªŒè¯é…ç½®
pnpm check-env

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

### å›¢é˜Ÿåä½œæµç¨‹
```bash
# 1. æä¾›é…ç½®æ¨¡æ¿
# .env.example (æäº¤åˆ°Git)
OPENAI_API_KEY=your_openai_api_key_here
DATABASE_URL=your_database_url_here

# 2. å›¢é˜Ÿæˆå‘˜åˆ›å»ºæœ¬åœ°é…ç½®
cp .env.example .env.local

# 3. å¡«å…¥çœŸå®çš„APIå¯†é’¥
# (ä¸æäº¤åˆ°Git)
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜è§£å†³
```bash
# é—®é¢˜1ï¼šç¯å¢ƒå˜é‡æœªåŠ è½½
# æ£€æŸ¥æ–‡ä»¶åå’Œä½ç½®
ls -la .env*

# é—®é¢˜2ï¼šå®¢æˆ·ç«¯æ— æ³•è®¿é—®å˜é‡
# ç¡®ä¿ä½¿ç”¨NEXT_PUBLIC_å‰ç¼€
echo $NEXT_PUBLIC_APP_NAME

# é—®é¢˜3ï¼šTypeScriptç±»å‹é”™è¯¯
# æ£€æŸ¥env.d.tsç±»å‹å®šä¹‰

# é—®é¢˜4ï¼šAPIå¯†é’¥æ— æ•ˆ
# éªŒè¯å¯†é’¥æ ¼å¼å’Œæƒé™
pnpm check-env
```

### è°ƒè¯•æŠ€å·§
```typescript
// è°ƒè¯•ç¯å¢ƒå˜é‡åŠ è½½
console.log('Environment variables:', {
  nodeEnv: process.env.NODE_ENV,
  openaiKey: process.env.OPENAI_API_KEY ? '***' : 'undefined',
  publicAppName: process.env.NEXT_PUBLIC_APP_NAME,
});
```

---

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

### å¿…å¤‡é…ç½®é¡¹
- [ ] åˆ›å»ºäº†.env.localæ–‡ä»¶
- [ ] é…ç½®äº†OPENAI_API_KEY
- [ ] è®¾ç½®äº†æ­£ç¡®çš„.gitignore
- [ ] å®šä¹‰äº†TypeScriptç±»å‹
- [ ] åˆ›å»ºäº†é…ç½®åŠ è½½å·¥å…·

### å®‰å…¨æ£€æŸ¥
- [ ] æ•æ„Ÿæ–‡ä»¶ä¸åœ¨Gitä¸­
- [ ] APIå¯†é’¥æ ¼å¼æ­£ç¡®
- [ ] æƒé™è®¾ç½®åˆç†
- [ ] å®šæœŸè½®æ¢è®¡åˆ’

### åŠŸèƒ½éªŒè¯
- [ ] ç¯å¢ƒå˜é‡æ­£ç¡®åŠ è½½
- [ ] APIè¿æ¥æµ‹è¯•é€šè¿‡
- [ ] ä¸åŒç¯å¢ƒé…ç½®æ­£ç¡®
- [ ] éƒ¨ç½²é…ç½®å®Œæ•´

---

<!-- _class: lead -->
# ğŸ‰ ç¯å¢ƒå˜é‡é…ç½®å®Œæˆï¼

## ç°åœ¨æ‹¥æœ‰å®‰å…¨å¯é çš„é…ç½®ç®¡ç†

**ä¸‹ä¸€ç« ï¼šå‰ç«¯åŸºç¡€å¼€å‘**
