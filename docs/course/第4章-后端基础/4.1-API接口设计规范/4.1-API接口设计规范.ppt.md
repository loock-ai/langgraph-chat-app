---
marp: true
theme: gaia
paginate: true
header: '4.1-APIæ¥å£è®¾è®¡è§„èŒƒ'
style: |
  section {
    font-size: 30px;
  }
---

<!-- _class: lead -->
# ç¬¬4ç«  åç«¯åŸºç¡€ ğŸ”™

## 4.1 APIæ¥å£è®¾è®¡è§„èŒƒ

**LangGraphæ™ºèƒ½èŠå¤©åº”ç”¨å¼€å‘æ•™ç¨‹**

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- **ç†è§£RESTful APIè®¾è®¡åŸåˆ™**
- **æŒæ¡Next.js API RoutesåŸºç¡€ç”¨æ³•**  
- **å­¦ä¼šè®¾è®¡æ¸…æ™°çš„æ¥å£ç»“æ„**
- **å»ºç«‹è‰¯å¥½çš„APIè®¾è®¡ä¹ æƒ¯**

ä¸ºèŠå¤©åº”ç”¨æ­å»ºè§„èŒƒçš„åç«¯æ¥å£ï¼

---

## ğŸ“š RESTful APIåŸºç¡€æ¦‚å¿µ

### HTTPæ–¹æ³•çš„æ­£ç¡®ä½¿ç”¨
- **GET** - è·å–æ•°æ®ï¼ˆå¦‚è·å–èŠå¤©å†å²ï¼‰
- **POST** - åˆ›å»ºæ•°æ®ï¼ˆå¦‚å‘é€æ¶ˆæ¯ï¼‰
- **PUT/PATCH** - æ›´æ–°æ•°æ®ï¼ˆå¦‚ä¿®æ”¹ä¼šè¯åç§°ï¼‰
- **DELETE** - åˆ é™¤æ•°æ®ï¼ˆå¦‚åˆ é™¤ä¼šè¯ï¼‰

### èµ„æºå¯¼å‘çš„URLè®¾è®¡
```
/api/chat          # èŠå¤©æ¶ˆæ¯èµ„æº
/api/chat/sessions # ä¼šè¯ç®¡ç†èµ„æº
```

---

## ğŸ—ï¸ Next.js API Routeså®è·µ

### è·¯ç”±æ–‡ä»¶ç»„ç»‡ç»“æ„
```
app/api/
â”œâ”€â”€ chat/
â”‚   â”œâ”€â”€ route.ts          # /api/chat
â”‚   â””â”€â”€ sessions/
â”‚       â””â”€â”€ route.ts      # /api/chat/sessions
```

### å¤„ç†ä¸åŒHTTPæ–¹æ³•
```typescript
// app/api/chat/route.ts
export async function GET() { /* è·å–å†å² */ }
export async function POST() { /* å‘é€æ¶ˆæ¯ */ }
```

---

## ğŸ’¡ èŠå¤©åº”ç”¨APIè®¾è®¡

### æ ¸å¿ƒæ¥å£è§„åˆ’
- **POST /api/chat** - å‘é€æ¶ˆæ¯ï¼Œæ”¯æŒæµå¼å“åº”
- **GET /api/chat** - è·å–æŒ‡å®šä¼šè¯çš„æ¶ˆæ¯å†å²
- **GET /api/chat/sessions** - è·å–æ‰€æœ‰ä¼šè¯åˆ—è¡¨
- **POST /api/chat/sessions** - åˆ›å»ºæ–°ä¼šè¯

### ç»Ÿä¸€æ•°æ®æ ¼å¼
```typescript
// æˆåŠŸå“åº”
{ success: true, data: {...} }
// é”™è¯¯å“åº”  
{ success: false, error: "é”™è¯¯ä¿¡æ¯" }
```

---

## ğŸ”— å®é™…ä»£ç å®ç°

### åŸºç¡€èŠå¤©æ¥å£
```typescript
// app/api/chat/route.ts
export async function POST(request: NextRequest) {
  const { message, threadId } = await request.json();
  
  // å¤„ç†èŠå¤©é€»è¾‘...
  return NextResponse.json({ 
    success: true, 
    data: responseData 
  });
}
```

---

## ğŸ”— è·å–å†å²è®°å½•æ¥å£

```typescript
export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url);
  const threadId = searchParams.get('threadId');
  
  if (!threadId) {
    return NextResponse.json({ 
      success: false, 
      error: 'ç¼ºå°‘ä¼šè¯ID' 
    });
  }
  
  // è·å–å†å²è®°å½•...
  return NextResponse.json({ 
    success: true, 
    data: { history: messages } 
  });
}
```

---

## ğŸŒŸ APIè®¾è®¡æœ€ä½³å®è·µ

### æ¥å£è®¾è®¡åŸåˆ™
- **è¯­ä¹‰åŒ–URL** - è·¯å¾„è¦è¡¨è¾¾æ¸…æ™°çš„èµ„æºå«ä¹‰
- **ç»Ÿä¸€å“åº”æ ¼å¼** - æˆåŠŸå’Œå¤±è´¥éƒ½ç”¨ä¸€è‡´çš„æ•°æ®ç»“æ„
- **åˆç†çŠ¶æ€ç ** - 200æˆåŠŸï¼Œ400å®¢æˆ·ç«¯é”™è¯¯ï¼Œ500æœåŠ¡å™¨é”™è¯¯
- **å‚æ•°éªŒè¯** - å¯¹è¾“å…¥å‚æ•°è¿›è¡Œå¿…è¦çš„éªŒè¯

### é”™è¯¯å¤„ç†è§„èŒƒ
```typescript
if (!message?.trim()) {
  return NextResponse.json({ 
    success: false, 
    error: 'æ¶ˆæ¯ä¸èƒ½ä¸ºç©º' 
  }, { status: 400 });
}
```

---

## ğŸ“‹ æ€»ç»“è¦ç‚¹

- **RESTfulåŸåˆ™** - HTTPæ–¹æ³•å’Œèµ„æºè·¯å¾„è¦è¯­ä¹‰åŒ–
- **Next.jsä¼˜åŠ¿** - API Routesæä¾›äº†ç®€æ´çš„å¼€å‘æ–¹å¼
- **ç»Ÿä¸€æ ¼å¼** - ä¸€è‡´çš„æ•°æ®ç»“æ„è®©å‰åç«¯åä½œæ›´é¡ºç•…
- **æœ€ä½³å®è·µ** - è‰¯å¥½çš„APIè®¾è®¡æ˜¯åç«¯å¼€å‘çš„åŸºç¡€

è§„èŒƒçš„APIè®¾è®¡è®©å¼€å‘æ›´é«˜æ•ˆï¼

---

## ğŸš€ ä¸‹ä¸€æ­¥é¢„å‘Š

æŒæ¡äº†APIè®¾è®¡åŸºç¡€åï¼Œæˆ‘ä»¬å°†å­¦ä¹ ï¼š

**4.2 æ•°æ®åº“å®é™…åº”ç”¨**
- SQLiteæ•°æ®åº“åŸºç¡€æ“ä½œ
- è®¾è®¡èŠå¤©åº”ç”¨çš„æ•°æ®æ¨¡å‹
- å®ç°åŸºæœ¬çš„CRUDåŠŸèƒ½

ä¸ºæˆ‘ä»¬çš„APIæä¾›æ•°æ®æŒä¹…åŒ–æ”¯æŒï¼
