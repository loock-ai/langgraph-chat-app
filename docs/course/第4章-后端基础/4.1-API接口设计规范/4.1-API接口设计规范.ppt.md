---
marp: true
theme: gaia
paginate: true
header: '4.1-API接口设计规范'
style: |
  section {
    font-size: 30px;
  }
---

<!-- _class: lead -->
# 第4章 后端基础 🔙

## 4.1 API接口设计规范

**LangGraph智能聊天应用开发教程**

---

## 🎯 学习目标

- **理解RESTful API设计原则**
- **掌握Next.js API Routes基础用法**  
- **学会设计清晰的接口结构**
- **建立良好的API设计习惯**

为聊天应用搭建规范的后端接口！

---

## 📚 RESTful API基础概念

### HTTP方法的正确使用
- **GET** - 获取数据（如获取聊天历史）
- **POST** - 创建数据（如发送消息）
- **PUT/PATCH** - 更新数据（如修改会话名称）
- **DELETE** - 删除数据（如删除会话）

### 资源导向的URL设计
```
/api/chat          # 聊天消息资源
/api/chat/sessions # 会话管理资源
```

---

## 🏗️ Next.js API Routes实践

### 路由文件组织结构
```
app/api/
├── chat/
│   ├── route.ts          # /api/chat
│   └── sessions/
│       └── route.ts      # /api/chat/sessions
```

### 处理不同HTTP方法
```typescript
// app/api/chat/route.ts
export async function GET() { /* 获取历史 */ }
export async function POST() { /* 发送消息 */ }
```

---

## 💡 聊天应用API设计

### 核心接口规划
- **POST /api/chat** - 发送消息，支持流式响应
- **GET /api/chat** - 获取指定会话的消息历史
- **GET /api/chat/sessions** - 获取所有会话列表
- **POST /api/chat/sessions** - 创建新会话

### 统一数据格式
```typescript
// 成功响应
{ success: true, data: {...} }
// 错误响应  
{ success: false, error: "错误信息" }
```

---

## 🔗 实际代码实现

### 基础聊天接口
```typescript
// app/api/chat/route.ts
export async function POST(request: NextRequest) {
  const { message, threadId } = await request.json();
  
  // 处理聊天逻辑...
  return NextResponse.json({ 
    success: true, 
    data: responseData 
  });
}
```

---

## 🔗 获取历史记录接口

```typescript
export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url);
  const threadId = searchParams.get('threadId');
  
  if (!threadId) {
    return NextResponse.json({ 
      success: false, 
      error: '缺少会话ID' 
    });
  }
  
  // 获取历史记录...
  return NextResponse.json({ 
    success: true, 
    data: { history: messages } 
  });
}
```

---

## 🌟 API设计最佳实践

### 接口设计原则
- **语义化URL** - 路径要表达清晰的资源含义
- **统一响应格式** - 成功和失败都用一致的数据结构
- **合理状态码** - 200成功，400客户端错误，500服务器错误
- **参数验证** - 对输入参数进行必要的验证

### 错误处理规范
```typescript
if (!message?.trim()) {
  return NextResponse.json({ 
    success: false, 
    error: '消息不能为空' 
  }, { status: 400 });
}
```

---

## 📋 总结要点

- **RESTful原则** - HTTP方法和资源路径要语义化
- **Next.js优势** - API Routes提供了简洁的开发方式
- **统一格式** - 一致的数据结构让前后端协作更顺畅
- **最佳实践** - 良好的API设计是后端开发的基础

规范的API设计让开发更高效！

---

## 🚀 下一步预告

掌握了API设计基础后，我们将学习：

**4.2 数据库实际应用**
- SQLite数据库基础操作
- 设计聊天应用的数据模型
- 实现基本的CRUD功能

为我们的API提供数据持久化支持！
