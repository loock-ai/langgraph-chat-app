---
marp: true
theme: gaia
paginate: true
header: '5.1-OpenAI API实际应用'
style: |
  section {
    font-size: 30px;
  }
---

<!-- _class: lead -->
# 第5章 AI集成 🤖

## 5.1 OpenAI API实际应用

**LangGraph智能聊天应用开发教程**

---

## 🎯 学习目标

- **深入理解OpenAI API的使用方法**
- **掌握模型配置和参数调优技巧**
- **学会消息格式处理和上下文管理**
- **实现基础的AI对话功能**

开启AI应用开发的核心技能！

---

## 📚 OpenAI API基础配置

### API密钥配置
```typescript
// 环境变量配置
OPENAI_API_KEY=your_api_key_here
OPENAI_MODEL_NAME=qwen-plus  // 推荐使用qwen-plus

// 代码中的配置
const model = new ChatOpenAI({
  openAIApiKey: process.env.OPENAI_API_KEY,
  modelName: process.env.OPENAI_MODEL_NAME || "qwen-plus"
});
```

安全的API密钥管理是AI应用的基础！

---

## 🏗️ 模型选择和参数调优

### qwen-plus模型优势
- **中文对话能力强** - 专门优化的中文大模型
- **性价比高** - 成本控制与性能的最佳平衡
- **响应速度快** - 适合实时聊天应用

### 核心参数解析
```typescript
const model = new ChatOpenAI({
  model: "qwen-plus",
  temperature: 0.7,        // 创造性控制(0-2)
  maxTokens: 2000,         // 最大输出长度
  streaming: true,         // 启用流式响应
});
```

---

## 💡 消息格式和上下文管理

### LangChain消息类型
```typescript
import { SystemMessage, HumanMessage, AIMessage } from '@langchain/core/messages';

// 系统消息 - 设置AI角色
const systemMsg = new SystemMessage("你是一个友好的AI助手");

// 用户消息
const userMsg = new HumanMessage("你好，请介绍一下自己");

// AI回复消息
const aiMsg = new AIMessage("你好！我是一个AI助手...");
```

标准化的消息格式让对话管理更简单！

---

## 🔗 实际代码实现

### 基础配置文件
```typescript
// app/agent/config/tools.config.ts
import { ChatOpenAI } from '@langchain/openai';

export const model = new ChatOpenAI({
  model: process.env.OPENAI_MODEL_NAME || "qwen-plus",
  temperature: 0.7,
  maxTokens: 2000,
  streaming: true,  // 启用流式响应
});

export async function callAI(messages: any[]) {
  const response = await model.invoke(messages);
  return response;
}
```

---

## 🔗 API调用实现

```typescript
// app/api/chat/route.ts
export async function POST(request: NextRequest) {
  const { message } = await request.json();
  
  try {
    // 创建用户消息
    const userMessage = new HumanMessage(message);
    
    // 调用AI模型
    const response = await model.invoke([userMessage]);
    
    return NextResponse.json({
      success: true,
      data: { content: response.content, role: 'assistant' }
    });
  } catch (error) {
    return NextResponse.json({
      success: false,
      error: 'AI服务暂时不可用'
    }, { status: 500 });
  }
}
```

---

## 🌟 参数调优实践

### Temperature参数效果
- **0.0-0.3**: 更准确、一致的回答
- **0.4-0.7**: 平衡创造性和准确性 ⭐
- **0.8-1.0**: 更有创意但可能不太准确
- **1.0+**: 非常创意但可能偏离主题

### maxTokens控制
```typescript
maxTokens: 2000,  // 适合聊天应用的长度
```

合理的参数设置是优质AI体验的关键！

---

## 🔧 最佳实践建议

### 开发技巧
- **环境变量管理** - 安全存储API密钥
- **错误处理** - 添加适当的try-catch
- **参数测试** - 尝试不同参数看效果
- **成本控制** - 监控API调用频率和成本

### 常见问题解决
- **API密钥错误** → 检查环境变量配置
- **模型调用失败** → 确认网络和API配额
- **响应格式异常** → 检查消息格式

---

## 📋 总结要点

- **API配置** - 正确配置密钥和模型参数是基础
- **模型选择** - qwen-plus在中文场景下表现优异
- **参数调优** - temperature控制创造性，maxTokens控制长度
- **消息格式** - 使用LangChain的标准消息类型
- **最佳实践** - 建立健壮的API调用机制

OpenAI API是AI应用的核心引擎！

---

## 🚀 下一步预告

掌握了OpenAI API基础后，我们将学习：

**5.2 LangGraphJS核心应用**
- StateGraph状态图构建
- 节点和边的设计原理
- 检查点持久化机制
- 可扩展的AI工作流

让AI应用更加智能和强大！
