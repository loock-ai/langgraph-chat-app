---
marp: true
theme: gaia
paginate: true
header: '5.2-LangGraphJSæ ¸å¿ƒåº”ç”¨'
style: |
  section {
    font-size: 30px;
  }
---

<!-- _class: lead -->
# ç¬¬5ç«  AIé›†æˆ ğŸ¤–

## 5.2 LangGraphJSæ ¸å¿ƒåº”ç”¨

**LangGraphçŠ¶æ€å›¾å·¥ä½œæµæ„å»º**

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- **æ·±å…¥ç†è§£LangGraphJSçš„StateGraphæ¦‚å¿µ**
- **æŒæ¡èŠ‚ç‚¹å’Œè¾¹çš„è®¾è®¡åŸç†**
- **å­¦ä¼šå®ç°æ£€æŸ¥ç‚¹æŒä¹…åŒ–**
- **æ„å»ºå¯æ‰©å±•çš„AIå·¥ä½œæµ**

æ‰“é€ æ™ºèƒ½åŒ–çš„AIå·¥ä½œæµç³»ç»Ÿï¼

---

## ğŸ“š StateGraphçŠ¶æ€å›¾åŸºç¡€

### æ ¸å¿ƒæ¦‚å¿µ
```typescript
import { StateGraph, MessagesAnnotation, START, END } from '@langchain/langgraph';

// StateGraph - æœ‰å‘å›¾ï¼Œå®šä¹‰AIåº”ç”¨çš„æ‰§è¡Œæµç¨‹
// MessagesAnnotation - å®šä¹‰çŠ¶æ€çš„æ•°æ®ç»“æ„
// STARTå’ŒEND - æµç¨‹çš„å¼€å§‹å’Œç»“æŸèŠ‚ç‚¹
```

StateGraphè®©AIåº”ç”¨çš„é€»è¾‘æ›´æ¸…æ™°ã€æ›´å¯æ§ï¼

---

## ğŸ—ï¸ èŠ‚ç‚¹(Node)è®¾è®¡åŸç†

### èŠå¤©èŠ‚ç‚¹å®ç°
```typescript
// èŠå¤©èŠ‚ç‚¹çš„æ ¸å¿ƒå‡½æ•°
async function chatbotNode(state: typeof MessagesAnnotation.State) {
  // state.messagesåŒ…å«å½“å‰çš„å¯¹è¯å†å²
  const response = await model.invoke(state.messages);
  
  // è¿”å›æ–°çš„æ¶ˆæ¯ï¼ŒLangGraphä¼šè‡ªåŠ¨åˆå¹¶åˆ°çŠ¶æ€ä¸­
  return { messages: [response] };
}
```

æ¯ä¸ªèŠ‚ç‚¹ä¸“æ³¨ä¸€ä¸ªä»»åŠ¡ï¼ŒèŒè´£æ¸…æ™°ï¼

---

## ğŸ’¡ æ£€æŸ¥ç‚¹æŒä¹…åŒ–æœºåˆ¶

### SqliteSaveré…ç½®
```typescript
import { SqliteSaver } from '@langchain/langgraph-checkpoint-sqlite';
import Database from 'better-sqlite3';

// åˆ›å»ºæ•°æ®åº“è¿æ¥
const db = new Database('chat_history.db');

// åˆ›å»ºæ£€æŸ¥ç‚¹ä¿å­˜å™¨
const checkpointer = new SqliteSaver(db);

// ç¼–è¯‘åº”ç”¨æ—¶æ·»åŠ æ£€æŸ¥ç‚¹æ”¯æŒ
const app = workflow.compile({ checkpointer });
```

æ£€æŸ¥ç‚¹è®©å¯¹è¯å†å²æ°¸ä¸ä¸¢å¤±ï¼

---

## ğŸ”— å®Œæ•´èŠå¤©æœºå™¨äººå®ç°

```typescript
// app/agent/chatbot.ts
import { StateGraph, MessagesAnnotation, START, END } from '@langchain/langgraph';

// åˆ›å»ºçŠ¶æ€å›¾å·¥ä½œæµ
const workflow = new StateGraph(MessagesAnnotation)
  .addNode('chatbot', chatbotNode)
  .addEdge(START, 'chatbot')
  .addEdge('chatbot', END);

// åˆ›å»ºæ£€æŸ¥ç‚¹ä¿å­˜å™¨
const checkpointer = new SqliteSaver(db);

// ç¼–è¯‘åº”ç”¨
export const app = workflow.compile({ checkpointer });
```

---

## ğŸ”— çŠ¶æ€ç®¡ç†å’Œä¼šè¯é…ç½®

```typescript
// ä¼šè¯é…ç½®ç¤ºä¾‹
const threadConfig = {
  configurable: { thread_id: 'user-session-123' }
};

// è°ƒç”¨èŠå¤©åº”ç”¨
const response = await app.invoke(
  { messages: [new HumanMessage('ä½ å¥½')] },
  threadConfig
);

// è·å–ä¼šè¯çŠ¶æ€
const state = await app.getState(threadConfig);
console.log('ä¼šè¯å†å²:', state?.values?.messages || []);
```

---

## ğŸŒŸ å·¥ä½œæµè®¾è®¡åŸåˆ™

### èŠ‚ç‚¹è®¾è®¡æœ€ä½³å®è·µ
- **å•ä¸€èŒè´£** - æ¯ä¸ªèŠ‚ç‚¹åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®ä»»åŠ¡
- **çŠ¶æ€ä¸€è‡´æ€§** - ç¡®ä¿çŠ¶æ€åœ¨èŠ‚ç‚¹é—´æ­£ç¡®ä¼ é€’
- **é”™è¯¯å¤„ç†** - åœ¨å…³é”®èŠ‚ç‚¹æ·»åŠ é”™è¯¯æ•è·
- **æ€§èƒ½è€ƒè™‘** - é¿å…åœ¨èŠ‚ç‚¹ä¸­è¿›è¡Œè€—æ—¶æ“ä½œ

### å¯æ‰©å±•æ€§è®¾è®¡
```typescript
// æ‰©å±•ï¼šæ·»åŠ å·¥å…·è°ƒç”¨èŠ‚ç‚¹
const workflow = new StateGraph(MessagesAnnotation)
  .addNode('chatbot', chatbotNode)
  .addNode('tool_call', toolCallNode)  // æ–°å¢å·¥å…·èŠ‚ç‚¹
  .addConditionalEdges('chatbot', shouldUseTool, {
    'tool': 'tool_call',
    'end': END
  });
```

---

## ğŸ”§ å¼€å‘è°ƒè¯•æŠ€å·§

### çŠ¶æ€æŸ¥çœ‹å’Œè°ƒè¯•
```typescript
// è°ƒè¯•å·¥ä½œæµçŠ¶æ€
async function debugWorkflow(threadId: string) {
  const state = await app.getState({
    configurable: { thread_id: threadId }
  });
  
  console.log('å·¥ä½œæµçŠ¶æ€:', {
    messageCount: state?.values?.messages?.length || 0,
    lastMessage: state?.values?.messages?.slice(-1)[0]?.content
  });
}
```

è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯è®©å¼€å‘æ›´é«˜æ•ˆï¼

---

## ğŸ“‹ æ€»ç»“è¦ç‚¹

- **StateGraphæ¶æ„** - æä¾›çµæ´»çš„AIå·¥ä½œæµç¼–æ’èƒ½åŠ›
- **èŠ‚ç‚¹è®¾è®¡** - æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ç‰¹å®šçš„å¤„ç†ä»»åŠ¡
- **çŠ¶æ€ç®¡ç†** - MessagesAnnotationå®šä¹‰æ ‡å‡†æ¶ˆæ¯çŠ¶æ€
- **æŒä¹…åŒ–æœºåˆ¶** - SqliteSaveræä¾›å¯é çš„çŠ¶æ€ä¿å­˜
- **å¯æ‰©å±•æ€§** - æ”¯æŒå¤æ‚çš„æ¡ä»¶åˆ†æ”¯å’Œå·¥å…·é›†æˆ

LangGraphJSè®©AIåº”ç”¨æ¶æ„æ›´ä¼˜é›…ï¼

---

## ğŸš€ ä¸‹ä¸€æ­¥é¢„å‘Š

æŒæ¡äº†LangGraphJSæ ¸å¿ƒæ¦‚å¿µåï¼Œæˆ‘ä»¬å°†å­¦ä¹ ï¼š

**5.3 æµå¼å“åº”å¤„ç†**
- streamEventsäº‹ä»¶ç³»ç»Ÿ
- å®æ—¶AIå¯¹è¯ä½“éªŒ
- æµå¼æ•°æ®ä¼ è¾“ä¼˜åŒ–
- å‰åç«¯æµå¼é›†æˆ

è®©AIå¯¹è¯æ›´åŠ æµç•…è‡ªç„¶ï¼

