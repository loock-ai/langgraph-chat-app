/**
 * 3.2 Next.jsé¡¹ç›®åº”ç”¨ - Next.jsé…ç½®æ–‡ä»¶
 * 
 * è¿™æ˜¯Next.jsé¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº†æ¡†æ¶çš„å„ç§è¡Œä¸ºå’Œä¼˜åŒ–è®¾ç½®ã€‚
 * 
 * ğŸ¯ å­¦ä¹ è¦ç‚¹ï¼š
 * 1. Next.jsé…ç½®çš„åŸºç¡€ç»“æ„å’Œè¯­æ³•
 * 2. æ€§èƒ½ä¼˜åŒ–çš„é…ç½®é€‰é¡¹
 * 3. å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚åŒ–é…ç½®
 * 4. å®‰å…¨æ€§å’Œå…¼å®¹æ€§è®¾ç½®
 * 5. è‡ªå®šä¹‰æ„å»ºå’Œéƒ¨ç½²é…ç½®
 */

import type { NextConfig } from 'next'

/**
 * Next.jsé…ç½®å¯¹è±¡
 * 
 * ğŸ”§ é…ç½®è¯´æ˜ï¼š
 * è¿™ä¸ªé…ç½®æ–‡ä»¶æ§åˆ¶Next.jsçš„å„ç§è¡Œä¸ºï¼ŒåŒ…æ‹¬ï¼š
 * - ç¼–è¯‘å’Œæ„å»ºè®¾ç½®
 * - æ€§èƒ½ä¼˜åŒ–é€‰é¡¹
 * - å¼€å‘ä½“éªŒæ”¹è¿›
 * - éƒ¨ç½²ç›¸å…³é…ç½®
 * - å®‰å…¨å’Œå…¼å®¹æ€§è®¾ç½®
 */
const nextConfig: NextConfig = {

    // ğŸš€ åŸºç¡€é…ç½®

    /**
     * TypeScripté…ç½®
     * 
     * ğŸ¯ ä½œç”¨ï¼š
     * - ignoreBuildErrors: æ˜¯å¦åœ¨æ„å»ºæ—¶å¿½ç•¥TypeScripté”™è¯¯
     * - å»ºè®®ï¼šå¼€å‘æ—¶è®¾ä¸ºfalseï¼Œç¡®ä¿ç±»å‹å®‰å…¨
     */
    typescript: {
        ignoreBuildErrors: false, // ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
    },

    /**
     * ESLinté…ç½®
     * 
     * ğŸ¯ ä½œç”¨ï¼š
     * - ignoreDuringBuilds: æ˜¯å¦åœ¨æ„å»ºæ—¶å¿½ç•¥ESLinté”™è¯¯
     * - å»ºè®®ï¼šä¿æŒfalseï¼Œç¡®ä¿ä»£ç è´¨é‡
     */
    eslint: {
        ignoreDuringBuilds: false, // ä¸¥æ ¼çš„ä»£ç è´¨é‡æ£€æŸ¥
    },

    // âš¡ æ€§èƒ½ä¼˜åŒ–é…ç½®

    /**
     * å®éªŒæ€§åŠŸèƒ½é…ç½®
     * 
     * ğŸ”¬ è¯´æ˜ï¼š
     * Next.jsçš„å®éªŒæ€§åŠŸèƒ½ï¼Œå¯ä»¥æå‰ä½“éªŒæ–°ç‰¹æ€§
     * æ³¨æ„ï¼šå®éªŒæ€§åŠŸèƒ½å¯èƒ½åœ¨æœªæ¥ç‰ˆæœ¬ä¸­å‘ç”Ÿå˜åŒ–
     */
    experimental: {
        /**
         * ä¼˜åŒ–åŒ…å¯¼å…¥
         * 
         * ğŸ’¡ ä½œç”¨ï¼š
         * - è‡ªåŠ¨ä¼˜åŒ–ç¬¬ä¸‰æ–¹åŒ…çš„å¯¼å…¥
         * - å‡å°‘bundleå¤§å°
         * - æå‡æ„å»ºé€Ÿåº¦
         */
        optimizePackageImports: [
            'lucide-react',    // å›¾æ ‡åº“ä¼˜åŒ–
            'date-fns',        // æ—¥æœŸåº“ä¼˜åŒ–ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
            'lodash',          // å·¥å…·åº“ä¼˜åŒ–ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
        ],

        /**
         * æœåŠ¡ç«¯ç»„ä»¶å¤–éƒ¨åŒ…é…ç½®
         * 
         * ğŸ’¡ ä½œç”¨ï¼š
         * - æŒ‡å®šå“ªäº›åŒ…åº”è¯¥åœ¨æœåŠ¡ç«¯è¿è¡Œ
         * - ä¼˜åŒ–æœåŠ¡ç«¯æ¸²æŸ“æ€§èƒ½
         */
        serverExternalPackages: [
            // åœ¨è¿™é‡Œæ·»åŠ éœ€è¦åœ¨æœåŠ¡ç«¯è¿è¡Œçš„åŒ…
        ],

        /**
         * ä¸¥æ ¼çš„Next.jsæ£€æŸ¥
         * 
         * ğŸ›¡ï¸ ä½œç”¨ï¼š
         * - å¯ç”¨æ›´ä¸¥æ ¼çš„Next.jsè§„åˆ™æ£€æŸ¥
         * - å¸®åŠ©å‘ç°æ½œåœ¨é—®é¢˜
         */
        strictNextHead: true,
    },

    // ğŸ–¼ï¸ å›¾ç‰‡ä¼˜åŒ–é…ç½®

    /**
     * å›¾ç‰‡ä¼˜åŒ–è®¾ç½®
     * 
     * ğŸ“¸ è¯´æ˜ï¼š
     * Next.jså†…ç½®çš„å›¾ç‰‡ä¼˜åŒ–åŠŸèƒ½é…ç½®
     */
    images: {
        /**
         * å›¾ç‰‡æ ¼å¼é…ç½®
         * 
         * ğŸ’¡ è¯´æ˜ï¼š
         * - æ”¯æŒç°ä»£å›¾ç‰‡æ ¼å¼
         * - è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ ¼å¼
         */
        formats: ['image/webp', 'image/avif'],

        /**
         * å…è®¸çš„å›¾ç‰‡åŸŸå
         * 
         * ğŸ”’ å®‰å…¨è€ƒè™‘ï¼š
         * - é™åˆ¶å›¾ç‰‡æ¥æºï¼Œé˜²æ­¢æ¶æ„å›¾ç‰‡
         * - æ ¹æ®å®é™…éœ€æ±‚æ·»åŠ åŸŸå
         */
        domains: [
            // åœ¨è¿™é‡Œæ·»åŠ å…è®¸çš„å›¾ç‰‡åŸŸå
            // 'example.com',
        ],

        /**
         * å›¾ç‰‡å°ºå¯¸é…ç½®
         * 
         * ğŸ“ è¯´æ˜ï¼š
         * - é¢„å®šä¹‰çš„å“åº”å¼å›¾ç‰‡å°ºå¯¸
         * - ä¼˜åŒ–ä¸åŒè®¾å¤‡çš„æ˜¾ç¤ºæ•ˆæœ
         */
        deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
        imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
    },

    // ğŸŒ å›½é™…åŒ–é…ç½®ï¼ˆå¯é€‰ï¼‰

    /**
     * å›½é™…åŒ–è®¾ç½®
     * 
     * ğŸŒ è¯´æ˜ï¼š
     * å¦‚æœéœ€è¦å¤šè¯­è¨€æ”¯æŒï¼Œå¯ä»¥å¯ç”¨æ­¤é…ç½®
     */
    // i18n: {
    //   locales: ['zh-CN', 'en-US'],
    //   defaultLocale: 'zh-CN',
    //   localeDetection: true,
    // },

    // ğŸ”§ æ„å»ºä¼˜åŒ–é…ç½®

    /**
     * è¾“å‡ºé…ç½®
     * 
     * ğŸ“¦ è¯´æ˜ï¼š
     * - æ§åˆ¶æ„å»ºè¾“å‡ºçš„æ ¼å¼å’Œè¡Œä¸º
     * - é€‚ç”¨äºä¸åŒçš„éƒ¨ç½²ç¯å¢ƒ
     */
    output: 'standalone', // ç‹¬ç«‹è¾“å‡ºï¼Œä¾¿äºDockeréƒ¨ç½²

    /**
     * å‹ç¼©é…ç½®
     * 
     * ğŸ—œï¸ è¯´æ˜ï¼š
     * - ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨å‹ç¼©èµ„æº
     * - å‡å°‘ä¼ è¾“å¤§å°
     */
    compress: true,

    /**
     * ç”ŸæˆETags
     * 
     * ğŸ·ï¸ è¯´æ˜ï¼š
     * - å¯ç”¨HTTP ETagæ”¯æŒ
     * - ä¼˜åŒ–ç¼“å­˜ç­–ç•¥
     */
    generateEtags: true,

    // ğŸ”’ å®‰å…¨é…ç½®

    /**
     * å®‰å…¨å¤´éƒ¨é…ç½®
     * 
     * ğŸ›¡ï¸ è¯´æ˜ï¼š
     * é…ç½®HTTPå®‰å…¨å¤´éƒ¨ï¼Œæå‡åº”ç”¨å®‰å…¨æ€§
     */
    async headers() {
        return [
            {
                source: '/(.*)',
                headers: [
                    {
                        key: 'X-Frame-Options',
                        value: 'DENY', // é˜²æ­¢iframeåµŒå…¥
                    },
                    {
                        key: 'X-Content-Type-Options',
                        value: 'nosniff', // é˜²æ­¢MIMEç±»å‹å—…æ¢
                    },
                    {
                        key: 'Referrer-Policy',
                        value: 'origin-when-cross-origin', // å¼•ç”¨ç­–ç•¥
                    },
                    {
                        key: 'Permissions-Policy',
                        value: 'camera=(), microphone=(), geolocation=()', // æƒé™ç­–ç•¥
                    },
                ],
            },
        ]
    },

    // ğŸ“ é‡å®šå‘é…ç½®

    /**
     * URLé‡å®šå‘è§„åˆ™
     * 
     * ğŸ”„ è¯´æ˜ï¼š
     * å®šä¹‰URLé‡å®šå‘è§„åˆ™ï¼Œç”¨äºï¼š
     * - æ—§URLå…¼å®¹
     * - SEOä¼˜åŒ–
     * - ç”¨æˆ·ä½“éªŒæ”¹è¿›
     */
    async redirects() {
        return [
            // ç¤ºä¾‹ï¼šå°†æ—§è·¯å¾„é‡å®šå‘åˆ°æ–°è·¯å¾„
            // {
            //   source: '/old-chat',
            //   destination: '/',
            //   permanent: true,
            // },
        ]
    },

    // ğŸ”— é‡å†™é…ç½®

    /**
     * URLé‡å†™è§„åˆ™
     * 
     * ğŸ”„ è¯´æ˜ï¼š
     * URLé‡å†™ä¸ä¼šæ”¹å˜æµè§ˆå™¨åœ°å€æ ï¼Œç”¨äºï¼š
     * - APIä»£ç†
     * - è·¯å¾„ç®€åŒ–
     * - å†…éƒ¨è·¯ç”±å¤„ç†
     */
    async rewrites() {
        return [
            // ç¤ºä¾‹ï¼šAPIä»£ç†é…ç½®
            // {
            //   source: '/api/external/:path*',
            //   destination: 'https://external-api.com/:path*',
            // },
        ]
    },

    // ğŸš« å¿½ç•¥é…ç½®

    /**
     * æ„å»ºæ—¶å¿½ç•¥çš„æ–‡ä»¶
     * 
     * ğŸ“ è¯´æ˜ï¼š
     * æŒ‡å®šåœ¨æ„å»ºè¿‡ç¨‹ä¸­åº”è¯¥å¿½ç•¥çš„æ–‡ä»¶å’Œç›®å½•
     */
    pageExtensions: ['tsx', 'ts', 'jsx', 'js', 'mdx', 'md'],

    // ğŸ”§ Webpacké…ç½®æ‰©å±•

    /**
     * è‡ªå®šä¹‰Webpacké…ç½®
     * 
     * âš™ï¸ è¯´æ˜ï¼š
     * å¯ä»¥æ‰©å±•Next.jsçš„é»˜è®¤Webpacké…ç½®
     * æ³¨æ„ï¼šè°¨æ…ä¿®æ”¹ï¼Œå¯èƒ½å½±å“æ„å»ºç¨³å®šæ€§
     */
    webpack: (config, { buildId, dev, isServer, defaultLoaders, nextRuntime, webpack }) => {

        // ğŸ“Š å¼€å‘ç¯å¢ƒçš„é¢å¤–é…ç½®
        if (dev) {
            // å¼€å‘ç¯å¢ƒç‰¹å®šçš„é…ç½®
            config.devtool = 'eval-cheap-module-source-map'
        }

        // ğŸ”§ è‡ªå®šä¹‰æ¨¡å—è§£æ
        config.resolve.fallback = {
            ...config.resolve.fallback,
            fs: false,      // æµè§ˆå™¨ç¯å¢ƒä¸æ”¯æŒfsæ¨¡å—
            net: false,     // æµè§ˆå™¨ç¯å¢ƒä¸æ”¯æŒnetæ¨¡å—
            dns: false,     // æµè§ˆå™¨ç¯å¢ƒä¸æ”¯æŒdnsæ¨¡å—
        }

        // ğŸ“¦ ä¼˜åŒ–é…ç½®
        if (!isServer) {
            config.optimization.splitChunks = {
                ...config.optimization.splitChunks,
                cacheGroups: {
                    ...config.optimization.splitChunks.cacheGroups,
                    vendor: {
                        test: /[\\/]node_modules[\\/]/,
                        name: 'vendors',
                        chunks: 'all',
                    },
                },
            }
        }

        return config
    },

    // ğŸ“± PWAé…ç½®ï¼ˆå¯é€‰ï¼‰

    /**
     * æ¸è¿›å¼Webåº”ç”¨é…ç½®
     * 
     * ğŸ“± è¯´æ˜ï¼š
     * å¦‚æœéœ€è¦PWAåŠŸèƒ½ï¼Œå¯ä»¥æ·»åŠ ç›¸å…³é…ç½®
     */
    // pwa: {
    //   dest: 'public',
    //   register: true,
    //   skipWaiting: true,
    // },

    // ğŸ” åˆ†æé…ç½®

    /**
     * Bundleåˆ†æé…ç½®
     * 
     * ğŸ“Š è¯´æ˜ï¼š
     * ç”¨äºåˆ†ææ‰“åŒ…ç»“æœï¼Œä¼˜åŒ–bundleå¤§å°
     */
    env: {
        ANALYZE: process.env.ANALYZE,
    },
}

// ğŸ“Š Bundleåˆ†æå™¨é›†æˆï¼ˆå¯é€‰ï¼‰
if (process.env.ANALYZE === 'true') {
    const withBundleAnalyzer = require('@next/bundle-analyzer')({
        enabled: true,
    })
    module.exports = withBundleAnalyzer(nextConfig)
} else {
    module.exports = nextConfig
}

export default nextConfig

/**
 * ğŸ“ å­¦ä¹ æ€»ç»“
 * 
 * é€šè¿‡è¿™ä¸ªNext.jsé…ç½®æ–‡ä»¶ï¼Œä½ å­¦åˆ°äº†ï¼š
 * 
 * 1. Next.jsé…ç½®çš„å®Œæ•´ç»“æ„å’Œé€‰é¡¹
 * 2. æ€§èƒ½ä¼˜åŒ–çš„é…ç½®ç­–ç•¥å’Œæœ€ä½³å®è·µ
 * 3. å®‰å…¨æ€§é…ç½®å’ŒHTTPå¤´éƒ¨è®¾ç½®
 * 4. å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚åŒ–é…ç½®
 * 5. Webpackè‡ªå®šä¹‰é…ç½®çš„æ–¹æ³•å’Œæ³¨æ„äº‹é¡¹
 * 6. å›¾ç‰‡ä¼˜åŒ–å’Œèµ„æºç®¡ç†é…ç½®
 * 7. URLå¤„ç†å’Œè·¯ç”±é…ç½®æŠ€å·§
 * 
 * ğŸ”§ é…ç½®çš„é‡è¦æ€§ï¼š
 * - åˆé€‚çš„é…ç½®å¯ä»¥æ˜¾è‘—æå‡åº”ç”¨æ€§èƒ½
 * - å®‰å…¨é…ç½®æ˜¯ç”Ÿäº§ç¯å¢ƒçš„å¿…è¦ä¿éšœ
 * - å¼€å‘ä½“éªŒçš„ä¼˜åŒ–æå‡å·¥ä½œæ•ˆç‡
 * - æ„å»ºä¼˜åŒ–å‡å°‘éƒ¨ç½²æ—¶é—´å’Œèµ„æºæ¶ˆè€—
 * 
 * ğŸš€ è¿›ä¸€æ­¥ä¼˜åŒ–æ–¹å‘ï¼š
 * - æ ¹æ®å…·ä½“éœ€æ±‚è°ƒæ•´é…ç½®å‚æ•°
 * - é›†æˆæ›´å¤šç¬¬ä¸‰æ–¹ä¼˜åŒ–å·¥å…·
 * - å®ç°ç¯å¢ƒç‰¹å®šçš„é…ç½®ç®¡ç†
 * - ç›‘æ§å’Œåˆ†æåº”ç”¨æ€§èƒ½æŒ‡æ ‡
 * - æŒç»­ä¼˜åŒ–æ„å»ºå’Œéƒ¨ç½²æµç¨‹
 */


